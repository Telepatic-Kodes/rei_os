---
phase: 07-analytics-charts
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - app/src/components/analytics/model-breakdown-chart.tsx
  - app/src/components/analytics/burn-rate-card.tsx
  - app/src/app/analytics/page.tsx
autonomous: true

must_haves:
  truths:
    - "A bar chart shows cost breakdown by model (opus vs sonnet)"
    - "A burn rate card shows projected budget exhaustion date"
    - "Burn rate severity indicator shows critical/warning/normal based on days remaining"
    - "All three chart sections are visible on the analytics page"
  artifacts:
    - path: "app/src/components/analytics/model-breakdown-chart.tsx"
      provides: "Horizontal bar chart of cost per model"
      contains: "BarChart"
    - path: "app/src/components/analytics/burn-rate-card.tsx"
      provides: "Burn rate projection with exhaustion date"
      contains: "daysUntilExhaustion"
  key_links:
    - from: "app/src/app/analytics/page.tsx"
      to: "app/src/components/analytics/model-breakdown-chart.tsx"
      via: "ModelBreakdownChart import and render"
      pattern: "ModelBreakdownChart"
    - from: "app/src/app/analytics/page.tsx"
      to: "app/src/components/analytics/burn-rate-card.tsx"
      via: "BurnRateCard import and render"
      pattern: "BurnRateCard"
---

<objective>
Build the cost-per-model breakdown bar chart and burn rate projection card, completing the analytics dashboard.

Purpose: Delivers ANLT-03 (cost-per-model breakdown) and ANLT-04 (burn rate projection), completing Phase 7's analytics requirements.
Output: Full analytics page with spend trends, model breakdown, and burn rate projection.
</objective>

<execution_context>
@/home/tomas/.claude/get-shit-done/workflows/execute-plan.md
@/home/tomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-analytics-charts/07-RESEARCH.md
@.planning/phases/07-analytics-charts/07-01-SUMMARY.md

@app/src/lib/data.ts
@app/src/lib/schemas.ts
@app/src/components/analytics/spend-trend-chart.tsx
@app/src/app/analytics/page.tsx
@data/analytics.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create model breakdown bar chart</name>
  <files>
    app/src/components/analytics/model-breakdown-chart.tsx
  </files>
  <action>
    Create `app/src/components/analytics/model-breakdown-chart.tsx` as a Client Component:

    - `"use client"` directive
    - Import `{ BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell }` from `"recharts"`
    - Import Card components from `@/components/ui/card`
    - Import `AnalyticsWindow` type from `@/lib/schemas`

    - Props: `{ data: AnalyticsWindow }`
    - Transform `data.byModel` into chart array:
      ```
      Object.entries(data.byModel).map(([model, stats]) => ({
        model: model.replace("claude-", "").replace(/-/g, " "), // "opus 4 5" -> readable
        cost: stats.cost,
        tokensIn: stats.tokensIn,
        tokensOut: stats.tokensOut,
      }))
      ```
    - Render horizontal BarChart (`layout="vertical"`):
      - ResponsiveContainer width="100%" height={200}
      - CartesianGrid strokeDasharray="3 3" horizontal={false}
      - XAxis type="number", tickFormatter prepending "$"
      - YAxis dataKey="model" type="category" width={100} fontSize 11
      - Tooltip with dollar formatting
      - Bar dataKey="cost" with radius={[0, 4, 4, 0]}
      - Use different colors per bar via Cell components: hsl(var(--chart-1)), hsl(var(--chart-2)), etc.
    - Wrap in Card with CardHeader title "Cost by Model"
    - Add a 7d/30d toggle (same pattern as spend-trend-chart) — Props become `{ data7d: AnalyticsWindow; data30d: AnalyticsWindow }`
    - Wrap with React.memo
  </action>
  <verify>
    `cd /home/tomas/Escritorio/AIAIAI_Consulting/app && npx tsc --noEmit` compiles without errors
  </verify>
  <done>
    ModelBreakdownChart renders a horizontal bar chart showing cost per model with 7d/30d toggle
  </done>
</task>

<task type="auto">
  <name>Task 2: Create burn rate card and wire into analytics page</name>
  <files>
    app/src/components/analytics/burn-rate-card.tsx
    app/src/app/analytics/page.tsx
  </files>
  <action>
    1. Create `app/src/components/analytics/burn-rate-card.tsx` as a Client Component:
       - `"use client"` directive
       - Import Card components, Badge from `@/components/ui/badge`
       - Import `Analytics` type from `@/lib/schemas`

       - Props: `{ analytics: Analytics; budget: number }`
       - Use 30d window for projection (most stable burn rate):
         - `burnRate = analytics.windows["30d"].burnRate` (daily average)
         - `spent = analytics.windows["30d"].totalCost`
         - `remaining = budget - spent`
         - `daysUntilExhaustion = burnRate > 0 ? Math.floor(remaining / burnRate) : Infinity`
         - `exhaustionDate = new Date(); exhaustionDate.setDate(exhaustionDate.getDate() + daysUntilExhaustion)`
       - Severity logic:
         - `< 7 days` -> "critical" (destructive badge)
         - `< 15 days` -> "warning" (outline badge)
         - `>= 15 days` -> "normal" (secondary badge)
       - Render Card with:
         - CardHeader: title "Burn Rate" + severity Badge
         - Daily average: `$X.XX/day` in text-2xl font-bold
         - Budget exhaustion: `N days (MM/DD/YYYY)` or "No spending detected"
         - Separator line
         - Spent (30d): `$X.XX` and Remaining: `$X.XX` in smaller text
         - Progress-like visual: simple div with background showing % spent of budget

    2. Update `app/src/app/analytics/page.tsx`:
       - Import `ModelBreakdownChart` from `@/components/analytics/model-breakdown-chart`
       - Import `BurnRateCard` from `@/components/analytics/burn-rate-card`
       - Replace placeholder divs with actual components
       - Layout the charts section as a 2-column grid (lg:grid-cols-2):
         - Left: SpendTrendChart (already there)
         - Right: BurnRateCard
       - Below: ModelBreakdownChart (full width)
       - Pass analytics data and budget to BurnRateCard: `analytics={analytics} budget={tokenData.budget.monthly}`
       - Pass analytics windows to ModelBreakdownChart: `data7d={analytics.windows["7d"]} data30d={analytics.windows["30d"]}`
  </action>
  <verify>
    - `cd /home/tomas/Escritorio/AIAIAI_Consulting/app && npx tsc --noEmit` compiles without errors
    - `npm run build` completes successfully
    - Navigate to http://localhost:3000/analytics — all three chart sections visible
  </verify>
  <done>
    Analytics page shows: spend trend chart, cost-per-model bar chart, and burn rate card with budget exhaustion projection. All Phase 7 requirements (ANLT-02, ANLT-03, ANLT-04) are met.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes in app directory
2. /analytics page loads with all three chart sections
3. Model breakdown bar chart shows opus vs sonnet costs
4. Burn rate card shows daily rate and projected exhaustion date
5. Severity badge reflects correct status based on remaining days
6. Both new components have 7d/30d or appropriate data toggling
</verification>

<success_criteria>
- Cost-per-model bar chart renders with actual analytics data (ANLT-03)
- Burn rate card shows projected budget exhaustion date (ANLT-04)
- Analytics page is complete with all three visualization sections
- No TypeScript errors, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/07-analytics-charts/07-02-SUMMARY.md`
</output>
