# Milestone v2.0: Analytics, Automation & Alerts

**Status:** ✅ SHIPPED 2026-02-01
**Phases:** 5-8
**Total Plans:** 11 (10 core + 1 gap-fix)

## Overview

Make the dashboard self-updating with historical analytics and proactive budget alerts so nothing needs manual checking.

## Phases

### Phase 5: Data Infrastructure & Safety

**Goal**: All data files are safely writable by automated processes with typed schemas and history support
**Depends on**: Phase 4 (existing sync scripts)
**Requirements**: INFR-01, INFR-02, INFR-03, AUTO-04, AUTO-05
**Plans**: 2 plans

Plans:
- [x] 05-01-PLAN.md — Zod schemas, atomic write utilities, JSONL history infrastructure, budget config extraction
- [x] 05-02-PLAN.md — Refactor data.ts with validation, update sync scripts, gitignore setup

### Phase 6: Automated Sync

**Goal**: Dashboard data stays current without manual intervention, with visible sync status
**Depends on**: Phase 5 (safe write infrastructure)
**Requirements**: AUTO-01, AUTO-02, AUTO-03, ANLT-01, ANLT-05
**Plans**: 3 plans

Plans:
- [x] 06-01-PLAN.md — SyncManager orchestrator + croner cron process + sync config
- [x] 06-02-PLAN.md — Manual sync API route, refresh button, sync status indicator in dashboard header
- [x] 06-03-PLAN.md — Pre-computed analytics generator and JSONL history integration

### Phase 7: Analytics & Charts

**Goal**: Users can see token spend trends, cost breakdowns, and budget projections at a glance
**Depends on**: Phase 6 (historical data from sync)
**Requirements**: ANLT-02, ANLT-03, ANLT-04
**Plans**: 2 plans

Plans:
- [x] 07-01-PLAN.md — Recharts integration, data helpers, spend trend chart, analytics page
- [x] 07-02-PLAN.md — Cost-per-model breakdown chart and burn rate projection card

### Phase 8: Budget Alerts & Notifications

**Goal**: Users are proactively warned before budget overruns through multiple notification channels
**Depends on**: Phase 6 (sync pipeline for threshold evaluation), Phase 7 (charts provide spend context)
**Requirements**: ALRT-01, ALRT-02, ALRT-03, ALRT-04, ALRT-05
**Plans**: 3 plans (2 core + 1 gap-fix)

Plans:
- [x] 08-01-PLAN.md — Alert config, threshold evaluation, dashboard banners, settings page
- [x] 08-02-PLAN.md — Desktop notifications (node-notifier) and browser Notification API
- [x] 08-03-PLAN.md — Path resolution fix for data file access (GAP-FIX for blocker)

---

## Milestone Summary

**Key Decisions:**
- Zod for runtime validation instead of TypeScript-only types
- Tmp+rename pattern for atomic JSON writes, direct append for JSONL
- Monthly JSONL rotation (YYYY-MM naming) with 6-month retention
- Cron runs as separate Node process, NOT inside Next.js
- croner for scheduling, concurrently for dev workflow
- sonner for toast notifications (official shadcn/ui component)
- Single analytics.json with nested 7d/30d/90d windows
- Recharts 3.7.0 for React 19 compatible charting
- Burn rate severity thresholds: critical (<7d), warning (<15d), normal (>=15d)
- Two alert modes: evaluateAlerts (fire-once) and getActiveAlerts (stateless for banners)
- Per-session dismiss via localStorage, not server-side
- Path resolution with ".." escape: Next.js cwd=/app but data at root, requires `path.join(process.cwd(), "..", "data")`

**Issues Resolved:**
- Idempotent sync via project name deduplication
- Lock file coordination prevents concurrent sync corruption
- Monthly alert reset via YYYY-MM comparison
- POST /api/settings/alerts 500 error — Root cause: missing ".." in path.join() calls (fixed via plan 08-03)
- Alert config and evaluator data access blocked — Resolved by aligning path resolution pattern across all modules

**Issues Deferred:**
- Manual sync route doesn't call evaluateAlerts() (banners work via getActiveAlerts poll)
- Desktop notification appearance untested on Linux

**Technical Debt Incurred:**
- node-notifier v10 used (v11 referenced in research doesn't exist)
- Browser notification permission flow untested in production

---

_For current project status, see .planning/MILESTONES.md_
